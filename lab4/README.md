# Лабораторная работа №4

## Описание

В рамках лабораторной работы №4 была расширена программная система управления торговым центром, разработанная в лабораторной работе №1, путем добавления графического пользовательского интерфейса (GUI)
с использованием шаблона MVC (Model-View-Controller). Система сохраняет функциональность интерфейса командной строки (CLI) и дополнительно реализует:

- Графический интерфейс на основе библиотеки Tkinter для управления магазинами, товарами, покупателями, продавцами и акциями.
- Все функции CLI, включая поиск товаров, совершение покупок, оформление возвратов, применение акций, аренду торговых площадей, оценку сервиса и отправку оповещений.
- Архитектуру MVC для разделения логики данных (Model), интерфейса (View) и управления (Controller).
- Документацию проекта в формате Markdown (`README.md`).
- Поддержку API через FastAPI (из лабораторной работы №3) для внешнего доступа.
- Юнит-тесты для проверки функциональности системы, включая новый контроллер.

Система разработана с учетом принципов SOLID и обеспечивает кроссплатформенную совместимость.

## Сценарий разработки проекта

### 1. Постановка задачи

Программная система должна:

- Сохранить функциональность CLI из лабораторной работы №1.
- Добавить графический интерфейс (GUI), реализующий все функции CLI:
  - Просмотр магазинов и акций.
  - Поиск товаров по названию или категории.
  - Просмотр деталей товаров с характеристиками.
  - Совершение покупок с выбором продавца.
  - Применение акций к покупкам.
  - Аренда торговых площадей.
  - Оценка сервиса продавцов.
  - Отправка оповещений.
  - Обработка возвратов с учетом политики магазина.
  - Смена текущего покупателя.
- Реализовать архитектуру MVC:
  - Model: Хранение данных и бизнес-логика.
  - View: CLI (`admin_interface.py`) и GUI (`gui.py`).
  - Controller: Управление взаимодействием между моделью и представлением.
- Обеспечить совместимость CLI и GUI с общей моделью данных.

### 2. Объектно-ориентированный анализ и проектирование

#### Анализ предметной области
Предметная область остается той же, что и в лабораторной работе №1 — управление торговым центром. Основные сущности:
- **ShoppingMall**: Торговый центр, содержащий магазины, галереи и акции.
- **Shop**: Магазин с товарами, продавцами, кассами и политикой возврата.
- **Product**: Товар с характеристиками, ценой, количеством и категорией.
- **Customer**: Покупатель с балансом, покупками и вопросами.
- **Seller**: Продавец, отвечающий на вопросы и обрабатывающий возвраты.
- **Promotion**: Акция с названием, описанием и скидкой.
- **Gallery**: Галерея внутри ТЦ, содержащая магазины.
- **CashRegister**: Касса для обработки платежей.

Новая сущность:
- **ShoppingMallController**: Контроллер, управляющий взаимодействием между моделью и представлениями (CLI и GUI).

#### Диаграмма состояний
Диаграмма состояний осталась аналогичной лабораторной работе №1, описывая жизненный цикл покупки:
1. Начало: Пользователь (через CLI или GUI) выбирает товар.
2. Поиск товара: Система ищет товар по названию или категории.
3. Покупка:
   - Проверка наличия товара.
   - Проверка баланса покупателя.
   - Обработка платежа через кассу.
   - Успех: товар списывается, покупка добавляется в историю.
   - Ошибка: недостаточно средств или товара.
4. Применение акции (опционально): Скидка применяется к покупке.
5. Возврат:
   - Проверка политики возврата магазина.
   - Проверка срока возврата.
   - Успех: товар возвращается, деньги зачисляются обратно.
   - Ошибка: срок возврата истек или возврат не предусмотрен.
6. Оценка сервиса: Пользователь оценивает продавца.

#### Диаграмма классов
Классы спроектированы с учетом принципов SOLID:
- **Single Responsibility Principle (SRP)**: Каждый класс отвечает за одну задачу (например, `ShoppingMallController` управляет взаимодействием, `gui.py` отображает интерфейс).
- **Open/Closed Principle (OCP)**: Классы открыты для расширения (например, новые типы представлений можно добавить без изменения контроллера).
- **Liskov Substitution Principle (LSP)**: Подклассы (например, `Seller`) могут заменять базовые классы.
- **Interface Segregation Principle (ISP)**: Классы используют только необходимые методы.
- **Dependency Inversion Principle (DIP)**: Высокоуровневые модули (CLI и GUI) зависят от абстракций (`ShoppingMallController`), а не от конкретных реализаций.

Новые классы:
- `ShoppingMallController` в `controller.py` для управления взаимодействием.
- `ShoppingMallGUI` в `gui.py` для реализации графического интерфейса.

### 3. Выбор технологий

- **Язык программирования**: Python.
- **Интерфейсы**:
  - CLI: Стандартный ввод/вывод через `admin_interface.py`.
  - GUI: Tkinter для кроссплатформенного графического интерфейса.
- **API**: FastAPI.
- **Библиотеки**:
  - Стандартная библиотека Python (`time` для работы с датами).
  - Tkinter для GUI.
  - FastAPI и Uvicorn для API.
- **Тестирование**: Модуль `unittest` для юнит-тестов.

Причины выбора:
- Python обеспечивает простоту разработки и поддержки.
- Tkinter — стандартная библиотека для создания GUI, не требующая дополнительных зависимостей.
- FastAPI предоставляет мощный и современный API-интерфейс.
- CLI и GUI обеспечивают разные способы взаимодействия с системой для различных пользователей.

### 4. Планирование интерфейса

Проект состоит из следующих файлов, каждый из которых отвечает за определенную часть функциональности:

- **Основные сущности**:
  - `entities.py` — классы `ShoppingMall`, `Shop`, `Product`, `Customer`, `Seller`, `Promotion`, `Gallery`, `CashRegister`.
- **Операции**:
  - `operations.py` — классы для операций: `ProductSearch`, `PurchaseOperation`, `ReturnOperation`, `PromotionOperation`, `RentOperation`, `ServiceRating`.
- **Контроллер**:
  - `controller.py` — класс `ShoppingMallController` для управления взаимодействием между моделью и представлениями.
- **Интерфейсы**:
  - `admin_interface.py` — класс `AdminInterface` для CLI.
  - `gui.py` — класс `ShoppingMallGUI` для GUI на Tkinter.
- **Запуск приложения**:
  - `main.py` (`main.py --gui`) — точка входа, инициализация данных и выбор интерфейса (CLI или GUI).
  - `main_api.py` — запуск FastAPI-сервера для API.
- **Тесты**:
  - `tests.py` — юнит-тесты для проверки функциональности, включая новый контроллер.
- **Документация**:
  - `README.md` — описание проекта, инструкции по установке и использованию.

### 5. Объяснение работы основных функций

- **`entities.py`**:
  - Хранит классы для представления сущностей торгового центра (`ShoppingMall`, `Shop`, `Product`, `Customer`, `Seller`, `Promotion`, `Gallery`, `CashRegister`).
  - Реализует базовые операции, такие как добавление товаров, продавцов и касс.
- **`operations.py`**:
  - `ProductSearch`: Поиск товаров по названию или категории.
  - `PurchaseOperation`: Совершение покупок с проверкой баланса и наличия.
  - `ReturnOperation`: Обработка возвратов с учетом политики магазина.
  - `PromotionOperation`: Применение скидок к покупкам.
  - `RentOperation`: Оформление аренды торговых площадей.
  - `ServiceRating`: Обновление рейтинга продавцов.
- **`controller.py`**:
  - `ShoppingMallController`: Обеспечивает взаимодействие между моделью и представлениями (CLI и GUI), предоставляя методы для всех операций.
- **`admin_interface.py`**:
  - Реализует CLI-меню с командами для управления торговым центром.
  - Использует `ShoppingMallController` для выполнения операций.
- **`gui.py`**:
  - Реализует GUI с вкладками для всех функций CLI.
  - Использует `ShoppingMallController` для взаимодействия с моделью.
  - Предоставляет интуитивный интерфейс с полями ввода, кнопками и текстовыми областями для вывода результатов.
- **`main.py`**:
  - Инициализирует торговый центр с тестовыми данными.
  - Поддерживает запуск CLI (`python main.py`) или GUI (`python main.py --gui`).
- **`main_api.py`**:
  - Запускает FastAPI-сервер для внешнего доступа к системе через RESTful API.
- **`tests.py`**:
  - Содержит юнит-тесты для проверки функциональности модели и контроллера.

### 6. Осуществление работы программы

1. **Запуск приложения**:
   - **CLI**:
     ```bash
     python main.py
     ```
     - Выберите команды из меню (например, "1" для просмотра магазинов, "5" для покупки).
   - **GUI**:
     ```bash
     python main.py --gui
     ```
     - Используйте вкладки для выполнения операций (поиск, покупка, возврат и т.д.).
     - Вводите данные в поля и нажимайте кнопки для выполнения действий.
     - Результаты отображаются в текстовых областях.
   - **API**:
     ```bash
     python main_api.py
     ```
     - Откройте `http://localhost:8090/docs` для тестирования API через Swagger UI.

2. **Примеры использования**:
   - **GUI**:
     - Перейдите на вкладку "Поиск товаров", выберите тип поиска ("По названию"), введите "Стиральная машина LG" и нажмите "Искать".
     - На вкладке "Покупка" введите название товара, количество и (опционально) продавца, затем нажмите "Купить".
     - На вкладке "Аренда" укажите название магазина, категорию, площадь и срок аренды, затем нажмите "Арендовать".
   - **CLI**:
     - Выберите "3" для поиска, введите название или категорию.
     - Выберите "5" для покупки, следуйте подсказкам для ввода данных.
   - **API**:
     - Отправьте POST-запрос на `/customers/` с JSON:
       ```json
       {
         "name": "Иван Иванов",
         "contact_info": "ivan@example.com",
         "balance": 1000.0
       }
       ```

3. **Тестирование**:
   ```bash
   python tests.py
   ```
   - Проверяет поиск, покупки, возвраты и другие операции.

### 7. Итоги

В ходе лабораторной работы №4 была успешно расширена система управления торговым центром, добавлен графический интерфейс (GUI) с использованием Tkinter и реализована архитектура MVC. Основные достижения:
- Сохранена полная функциональность CLI из лабораторной работы №1.
- Реализован GUI, обеспечивающий интуитивное управление всеми функциями системы.
- Внедрена архитектура MVC, разделяющая модель, представление и контроллер.
- Добавлен `ShoppingMallController` для унифицированного взаимодействия CLI и GUI с моделью.
- Обновлены юнит-тесты для проверки нового контроллера.
- Подготовлена документация в `README.md`, описывающая проект, установку и использование.
- Сохранена поддержка API через FastAPI.

Особое внимание было уделено:
- Совместимости CLI и GUI с общей моделью данных.
- Удобству графического интерфейса с вкладками для всех операций.
- Обработке ошибок в GUI с использованием всплывающих сообщений.
- Соблюдению принципов SOLID при проектировании новых компонентов.
